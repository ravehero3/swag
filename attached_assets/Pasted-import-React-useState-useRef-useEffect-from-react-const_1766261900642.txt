import React, { useState, useRef, useEffect } from 'react';

const Star = ({ style }) => (
  <div
    className="absolute rounded-full bg-white"
    style={style}
  />
);

const StarryBackground = () => {
  const [stars, setStars] = useState([]);

  useEffect(() => {
    const initialStars = Array.from({ length: 50 }, (_, i) => ({
      id: i,
      left: Math.random() * 100,
      top: Math.random() * 100,
      size: Math.random() * 2 + 1,
      opacity: Math.random(),
      duration: Math.random() * 3 + 2,
      delay: Math.random() * 2,
    }));
    setStars(initialStars);
  }, []);

  return (
    <div className="absolute inset-0 overflow-hidden">
      {stars.map((star) => (
        <Star
          key={star.id}
          style={{
            left: `${star.left}%`,
            top: `${star.top}%`,
            width: `${star.size}px`,
            height: `${star.size}px`,
            animation: `twinkle ${star.duration}s ease-in-out ${star.delay}s infinite`,
            opacity: star.opacity,
          }}
        />
      ))}
      <style>{`
        @keyframes twinkle {
          0%, 100% { opacity: 0.2; }
          50% { opacity: 1; }
        }
      `}</style>
    </div>
  );
};

const CustomIcon = ({ src, size }) => (
  <img 
    src={src} 
    alt="icon" 
    style={{ 
      width: `${size * 0.6}px`, 
      height: `${size * 0.6}px`,
      objectFit: 'contain'
    }} 
  />
);

const Dock = () => {
  const [hoveredIndex, setHoveredIndex] = useState(null);
  const [mouseX, setMouseX] = useState(null);
  const dockRef = useRef(null);

  const customApps = [
    { customIcon: 'https://i.imgur.com/X8qGBKZ.png', name: 'Friendly Ghosts' },
    { customIcon: 'https://i.imgur.com/TuqCHV5.png', name: 'One Shot Kit' },
    { customIcon: 'https://i.imgur.com/5eP2Unn.png', name: 'Friendly Aliens' },
    { customIcon: 'https://i.imgur.com/kPPH2wm.png', name: 'Friendly Ghosts' },
    { customIcon: 'https://i.imgur.com/E8r7rYf.png', name: 'Drum Kit' },
    { customIcon: 'https://i.imgur.com/NqBMnLV.png', name: 'One Shot Kit' },
    { customIcon: 'https://i.imgur.com/q3ohG1Z.png', name: 'Friendly Aliens 2' },
    { customIcon: 'https://i.imgur.com/2g4kBkC.png', name: 'Friendly Aliens 3' },
    { customIcon: 'https://i.imgur.com/wl8O0Fy.png', name: 'One Shot Kit' },
    { customIcon: 'https://i.imgur.com/vQjJiLd.png', name: 'Friendly Ghosts' },
    { customIcon: 'https://i.imgur.com/6kLO5bm.png', name: 'White Magic 3' },
  ];

  const handleMouseMove = (e) => {
    if (dockRef.current) {
      const rect = dockRef.current.getBoundingClientRect();
      setMouseX(e.clientX - rect.left);
    }
  };

  const handleMouseLeave = () => {
    setMouseX(null);
    setHoveredIndex(null);
  };

  const getScale = (index) => {
    if (mouseX === null) return 1;
    
    const dockRect = dockRef.current?.getBoundingClientRect();
    if (!dockRect) return 1;

    const iconElements = dockRef.current.querySelectorAll('.dock-icon');
    if (!iconElements[index]) return 1;

    const iconRect = iconElements[index].getBoundingClientRect();
    const iconCenter = iconRect.left + iconRect.width / 2 - dockRect.left;
    const distance = Math.abs(mouseX - iconCenter);
    
    const maxDistance = 150;
    const maxScale = 2.5;
    const minScale = 1;
    
    if (distance > maxDistance) return minScale;
    
    const scale = maxScale - ((maxScale - minScale) * (distance / maxDistance));
    return scale;
  };

  return (
    <div className="relative w-full h-screen overflow-hidden bg-black">
      {/* Background with gradient to center */}
      <div className="absolute inset-0 bg-gradient-to-b from-gray-900 via-blue-950 to-black">
        <StarryBackground />
      </div>
      
      {/* Edge fade to black - all sides */}
      <div 
        className="absolute inset-0 pointer-events-none"
        style={{
          background: `
            radial-gradient(ellipse at center, transparent 40%, black 100%)
          `
        }}
      />

      {/* Dock container */}
      <div className="relative z-10 flex items-end justify-center h-full pb-8">
        <div
          ref={dockRef}
          onMouseMove={handleMouseMove}
          onMouseLeave={handleMouseLeave}
          className="relative flex items-end gap-2 px-3 py-3 rounded-xl bg-gray-900/80 backdrop-blur-lg border border-gray-700/50"
        >
          {customApps.map((app, index) => {
            const scale = getScale(index);
            const baseSize = 56;
            const size = baseSize * scale;
            const translateY = -(size - baseSize) / 2;

            return (
              <div
                key={index}
                className="dock-icon flex items-end justify-center transition-all duration-200 ease-out"
                onMouseEnter={() => setHoveredIndex(index)}
                style={{
                  transform: `translateY(${translateY}px)`,
                  width: `${baseSize}px`,
                  height: `${baseSize}px`,
                }}
              >
                <div
                  className="relative flex items-center justify-center rounded-md bg-black/80 shadow-lg cursor-pointer hover:shadow-2xl transition-shadow"
                  style={{
                    width: `${size}px`,
                    height: `${size}px`,
                  }}
                >
                  <CustomIcon src={app.customIcon} size={size} />
                  {hoveredIndex === index && (
                    <div className="absolute -top-12 left-1/2 transform -translate-x-1/2 px-3 py-1 bg-gray-800/90 text-white text-sm rounded-lg whitespace-nowrap backdrop-blur-sm">
                      {app.name}
                    </div>
                  )}
                </div>
              </div>
            );
          })}
        </div>
      </div>
    </div>
  );
};

export default Dock;